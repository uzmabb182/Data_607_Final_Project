---
title: "Data 607 - Final Project"
output: html_document
---

### Project Proposal:

Source of motivation for the final project: Gentrification Analysis

NJ Housing Prices dataset: https://www.realtor.com/research/data/

Highest level of educational attainment:	Completing College

 https://data.ers.usda.gov/reports.aspx?ID=17829
 
Web Scraping list of fips code: https://en.wikipedia.org/wiki/List_of_United_States_FIPS_codes_by_county

API Call to census five years data:

https://api.census.gov/data/2019/acs/acs1?get=NAME,B01001_001E&for=county:*

I am sharing Forbes magazine's article. My source of motivation for this project is to investigate one of the paperâ€™s key findings including:

"Students with a family income of $100,000 or more are more than twice as likely as students with family income under $50,000 to have combined SAT test scores of 1400 to 1600".

I will perform web scraping to fetch SAT data for several years and API call for the census five-year data. Both of my datasets will be for the state of New Jersey counties. I will perform the linear regression and try for other regression to find the correlation between the family income and students' SAT scores.

Also, perform the one of the machine learning to predict the next year's SAT outcome.


Importing Libraries

```{r}
library(tidycensus)
library(tidyverse)
library(dplyr)
library(plotly)
library(tidyr)
library(stringr)
library(rvest)

```

### API Call for census data for the year 2015-19

```{r}
Sys.setenv(census_api_key = "f7ce5a76ddf2088c73fda9c0a87410995cebbffa")
Sys.getenv("census_api_key")
```


### Access the API key
### Save the Census API key in the environmental variable.
```{r}
#census_api_key("YOUR KEY GOES HERE", install = TRUE)
```


```{r}
Sys.getenv("census_api_key")
```


```{r}
# https://api.census.gov/data/2019/acs/acs1?get=NAME,B01001_001E&for=county:*

nj_wide <- get_acs(
  geography = "county",
  state = "NJ",
  variables = c(population = "B01003_001E",
                median_age = "B01002_001E",
                household_income = "B19013_001E",
                per_capita_income = "B19301_001E",
                poverty_count = "B17001_002E",
                unemployment_count = "B23025_005E"
                ),
  output = "wide",
  year = 2020
)

head(nj_wide)

```

### Selecting the column of interest

```{r}
census_df <- select(nj_wide, population, median_age, household_income, per_capita_income, poverty_count, unemployment_count)

head(census_df)
```


### Checking the working directory path and exporting data frame into a CSV file

```{r}
# Get working directory path
path <- getwd()

path

```


### Web Scraping Counties fips code


### Generate the html source code by calling the read_html function

```{r}

webpage <- read_html("https://en.wikipedia.org/wiki/List_of_United_States_FIPS_codes_by_county")

tbls <- html_nodes(webpage, "table")

head(tbls)
```

### Calling html_nodes function with CSS Selector and generating the table using html_table 

```{r}
# subset list of table nodes for items 3 & 4
fips_table <- webpage %>%
        html_nodes("#mw-content-text") %>% html_table() %>% .[[1]]
        
head(fips_table)
```

### Data Cleaning for fips_df:

### Renaming the columns

```{r}
fips_table <- fips_table %>% 
  rename(
    fips_codes = X1,
    county = X2,
    state = X3
    )
head(fips_table)
```

### Removing the unwanted rows

```{r}

fips_table <- fips_table[-c(1, 2), ]

head(fips_table)
```

### Filtering the data for New Jersey

```{r}
fips_df <- filter(fips_table, state == "New Jersey")

head(fips_df)
```

### Removing the string 'county' from county column

```{r}
fips_df$county<-gsub(" County","",as.character(fips_df$county))

head(fips_df)
```

### Reading the raw NJ Housing Prices data from GitHub

```{r}
housing_df <- read_csv("https://raw.githubusercontent.com/uzmabb182/Data_607_Final_Project/main/nj_housing_prices_2017_19.csv")

head(housing_df)
```

### Data Cleaning for housing_df:

```{r}
# Split name column into two

housing_df <- housing_df %>%
  separate(county_name, c("county", "state_abbr"), ",")
housing_df 
```

### Data Cleaning for education_df:

### Reading the education data from GitHub

### Reading the raw NJ Housing Prices data from GitHub

```{r}
education_df <- read_csv("https://raw.githubusercontent.com/uzmabb182/Data_607_Final_Project/main/ers_usda_education.csv")

head(education_df)
```

### Filtering the data for New Jersey

```{r}
education_df <- filter(education_df, State == "NJ")

head(education_df)
```

### Cleaning/Transforming ers_usda_education_data, education_df:

```{r}
head(education_df)
```


```{r}
colnames(education_df)
```


### Dropping 4:32 columns

```{r}

education_df <- select(education_df, -(4:39))
                           

head(education_df)
```

### Rename the columns by removing space with underscore

```{r}
names(education_df) <- gsub(" ", "_", names(education_df))

head(education_df)
```

### Removing  comma from column names

```{r}
names(education_df) <- gsub(",", "", names(education_df))

head(education_df)
```

### Removing  apostrophy from column names

```{r}
names(education_df) <- gsub("'", "", names(education_df))

head(education_df)
```

### Replacing dash with underscore in column names

```{r}
names(education_df) <- gsub("-", "_", names(education_df))

head(education_df)
```


### Making column names to lowercase

```{r}
names(education_df) <- tolower(names(education_df))    # Convert colnames to lower case
head(education_df)
```

### Removing the string  'county' from 'area_name'

```{r}
education_df$area_name <-gsub(" County","",as.character(education_df$area_name))

head(education_df)
```

### Dropping the duplicate rows

```{r}
education_df <- education_df %>% distinct()

head(education_df)
```


### fill NA with 0 in education_df

```{r}
education_df[is.na(education_df)] <- 0

head(education_df)
```

```{r}
names(education_df)[3] <- c('county')

head(education_df)
```
### Drop first row
```{r}
education_df <- education_df[-c(seq(1, 1, by=0)),]

head(education_df)
```


```{r}
# sort by state and county
# sort the dataframe in R using arrange

education_df <- arrange(education_df, county)

head(education_df)
```


```{r}
glimpse(education_df)
```


`



